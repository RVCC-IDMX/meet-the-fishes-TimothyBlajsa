<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Series of Fishy Scenes</title>
    <link rel="shortcut icon" href="img/favicon.png" type="image/x-icon">

    <!--

        First note what we're loading in.

        We could also do this the JavaScript Module route, but we'll learn about that later.

    -->
    <script src="https://pixijs.download/release/pixi.js"></script>
    <script src="js/bezier.js"></script>
    <script src="js/animate.js"></script>
    <script src="js/ui_elements.js"></script>
</head>

<body>

    <script>

        // Audio event listener
        let audio = document.createElement("audio");
        audio.autoplay = true;
        audio.src = "aquarium.wav";

        document.addEventListener("mousemove", () => {
            audio.play();
        });

        //
        // Basic setup
        //

        //The App
        var app = new PIXI.Application({
            width: 640,
            height: 480,
            backgroundColor: 0x000000
        });
        var stage = app.stage;
        var view = app.view;

        //Add view to the document
        document.body.appendChild(app.view);

        // My background sprite
        let background = PIXI.Sprite.from("img/background.jpg");
        background.scale.set(.7);
        app.stage.addChild(background);

        /*
            Depending on the system or context, these can be called "scenes" "views" "pages" "panels" or all sorts of other things.
    
            The important bit is that they are each a grouping or state of different interface elements that need to be on the screen at different times.
    
            We'll call them "scenes" – if only because they're going up onto the Pixi.js stage object when we need them.
        */

        //
        // Let's create a few really boring scenes using Pixi.js Containers
        //

        let nextButtonText = new PIXI.Text("Next >");
        //SCENE 1 acts as base 
        let scene1 = new PIXI.Container();

        let titleCard = new PIXI.Graphics();
        titleCard.beginFill(0xFFFFFF);
        titleCard.drawRoundedRect(-10,0,650,650);
        
        titleCard.alpha = .85;
        scene1.addChild(titleCard);

        //Using our button object let's create a "next" button.
        let nextButton = UI.Button(0, 0, "Next >");
        //nextButton.radius = .75;

        //Let's place it in the bottom right-hand corner of the screen (regardless of size)
        nextButton.x = app.view.width - nextButton.width;
        nextButton.y = app.view.height - nextButton.height;

        //And place it into the scene
        scene1.addChild(nextButton);

       

        //And let's add some text to tell us which scene we're on
        let scene1Text = new PIXI.Text("Surreal Aquarium", {
            fontFamily: 'Sarif',
            fontSize: 35,
            fill: 0x000000,
        });
        scene1Text.x = 185;
        scene1Text.y = 200;

        //And place it into the scene
        scene1.addChild(scene1Text);

        // begin sprites for base state

        // My First Sprite
        let fish1 = PIXI.Sprite.from("img/bigfish.png");

        // Change sprite coordinates
        fish1.x = 420;
        fish1.y = 0;

        // Change sprite size
        fish1.scale.set(.095);

        // Add it to the stage
        app.stage.addChild(fish1);

        // My Second Sprite
        let fish2 = PIXI.Sprite.from("img/smallfish.png");

        // Change sprite2 size
        fish2.scale.set(.07);
        fish2.x = 30;

        // Add it to the stage
        app.stage.addChild(fish2);

        // My third fish sprite
        let fish3 = PIXI.Sprite.from("img/betta.png");
        fish3.scale.set(.1);
        fish3.x = 350;
        fish3.y = 50;
        fish3.tint = 0x2e3f6b;
        app.stage.addChild(fish3);



        // My kelp sprite
        let kelp1 = PIXI.Sprite.from("img/kelp.png");
        kelp1.scale.set(.5);
        kelp1.tint = 0x212f55;
        app.stage.addChild(kelp1);

        // My coral sprite
        let coral = PIXI.Sprite.from("img/coral.png");
        coral.x = 300;
        coral.scale.set(.5);
        coral.tint = 0x253152;
        app.stage.addChild(coral);

        // My school sprite
        let school = PIXI.Sprite.from("img/school.png");
        school.tint = 0x090c14;
        school.x = 200;
        school.y = 55;
        school.scale.set(.15);
        app.stage.addChild(school);

        // My second kelp sprite
        let kelp2 = PIXI.Sprite.from("img/kelp.png");
        kelp2.scale.set(.675);
        kelp2.y = .4;
        app.stage.addChild(kelp2);

        // My second coral sprite
        let coral2 = PIXI.Sprite.from("img/coral.png");
        coral2.scale.set(.8);
        coral2.y = 20;
        coral2.x = -400;
        coral2.tint = 0x5676c7;
        app.stage.addChild(coral2);

        // My container for the first two fish sprites
        var my_container = new PIXI.Container();
        my_container.addChild(fish1);
        my_container.addChild(fish2);
        my_container.y = 100;
        app.stage.addChild(my_container);

        // My sprite for the bubbles
        let bubble1 = new PIXI.Sprite.from("img/bubble.png");
        bubble1.scale.set(.01);
        app.stage.addChild(bubble1);

        let bubble2 = new PIXI.Sprite.from("img/bubble.png");
        bubble2.scale.set(.01);
        bubble2.x = 80;
        app.stage.addChild(bubble2);

        let bubble3 = new PIXI.Sprite.from("img/bubble.png");
        bubble3.scale.set(.01);
        bubble3.x = 90;
        app.stage.addChild(bubble3);

        let bubble4 = new PIXI.Sprite.from("img/bubble.png");
        bubble4.scale.set(.01);
        bubble4.x = 105;
        app.stage.addChild(bubble4);

        let bubble5 = new PIXI.Sprite.from("img/bubble.png");
        bubble5.scale.set(.01);
        bubble5.x = 550;
        app.stage.addChild(bubble5);

        let bubble6 = new PIXI.Sprite.from("img/bubble.png");
        bubble6.scale.set(.01);
        bubble6.x = 570;
        app.stage.addChild(bubble6);

        let bubble7 = new PIXI.Sprite.from("img/bubble.png");
        bubble7.scale.set(.01);
        bubble7.x = 600;
        app.stage.addChild(bubble7);

        let bubble8 = new PIXI.Sprite.from("img/bubble.png");
        bubble8.scale.set(.01);
        bubble8.x = 610;
        app.stage.addChild(bubble8);

        //SCENE 1 Specific animations
        // animate fish1
        async function idleSwim1() {
            await Animate.to(fish1, {
                x: 420, y: 20,
                duration: 3000,
                easing: Animate.easeInOut
            });
            await pause(400);
            fish1.width = 160;
            await pause(100);
            fish1.width = 185;
            await Animate.to(fish1, {
                x: 420, y: 50,
                duration: 2000,
                easing: Animate.easeInOut
            });
            await pause(400);
            fish1.width = 165;
            await pause(100);
            fish1.width = 185;

            idleSwim1();
        }
        idleSwim1();


        //SCENE 2
        let scene2 = new PIXI.Container();

        //Using our button object let's create a "next" button.
        let backButton = UI.Button(0, 0, "< Back");

        //Let's place it in the bottom left-hand corner of the screen (regardless of size)
        backButton.x = 0;
        backButton.y = app.view.height - backButton.height;

        //And place it into the scene
        scene2.addChild(backButton);

        //And let's also add some text to tell us which scene we're on
        let scene2Text = new PIXI.Text("Rainbow Fish", { fontFamily: 'Sarif', fill: 0xFFFFFF });

        //And place it into the scene
        scene2.addChild(scene2Text);


        //Now let's add the first scene to the stage
        app.stage.addChild(scene1);

        //Scene Two Content

        //scene mask
        let sceneTwoMask = new PIXI.Graphics();
        sceneTwoMask.beginFill(0xEEEEEE);
        sceneTwoMask.drawCircle(0, 0, 275, 275);
        sceneTwoMask.alpha = .95;
        sceneTwoMask.x = 500;
        sceneTwoMask.y = 75;
        scene2.addChild(sceneTwoMask)

        let testFishText = new PIXI.Text('This is the Rainbow Fish \nIt likes to change colors \nrandomly and according \nto specific time intervals. \nSome say it tastes like \nskittles candy', { fill: 0x000000 });
        testFishText.x = 325;
        testFishText.y = 75;
        testFishText.style.fontFamily = 'Sans-Sarif';

        scene2.addChild(testFishText);

        //SCene two buttons
        let nextButtonTwo = UI.Button(440, 380, "Next >");

        scene2.addChild(nextButtonTwo);

        // nextButton.x = app.view.width - nextButton.width;
        // nextButton.y = app.view.height - nextButton.height;

        //Scene 3 
        let scene3 = new PIXI.Container();
        let scene3Text = new PIXI.Text("Betta Fish", { fill: 0xFFFFFF });
        scene3Text.x = 510;
        scene3.addChild(scene3Text);

        //scene mask
        let sceneThreeMask = new PIXI.Graphics();
        sceneThreeMask.beginFill(0xEEEEEE);
        sceneThreeMask.drawCircle(0, 0, 275, 275);
        sceneThreeMask.alpha = .95;
        sceneThreeMask.x = 75;
        sceneThreeMask.y = 125;
        scene3.addChild(sceneThreeMask)

        let sceneThreeMaskTwo = new PIXI.Graphics();
        sceneThreeMaskTwo.beginFill(0xEEEEEE);
        sceneThreeMaskTwo.drawCircle(0, 0, 125, 125);
        sceneThreeMaskTwo.alpha = .95;
        sceneThreeMaskTwo.x = 500;
        sceneThreeMaskTwo.y = 225;
        scene3.addChild(sceneThreeMaskTwo)

        let fish2Text = new PIXI.Text('This is the Betta Fish \nA perfect digital replica \nof my own real betta, \nit spends time making \nbubble nests and resting \non its leaf', { fill: 0x000000 });
        fish2Text.x = 50;
        fish2Text.y = 75;
        fish2Text.style.fontFamily = 'Sans-Sarif';

        scene3.addChild(fish2Text);

        //Scene 3 Buttons
        let backButtonTwo = UI.Button(0, 380, "< Back");
        scene3.addChild(backButtonTwo);
        let nextButtonThree = UI.Button(440, 380, "Next >");
        scene3.addChild(nextButtonThree);


        //Scene 4
        let scene4 = new PIXI.Container();
        let scene4Text = new PIXI.Text("Silver Fish", { fill: 0xFFFFFF });
        scene4.addChild(scene4Text);

        //scene mask
        let sceneFourMask = new PIXI.Graphics();
        sceneFourMask.beginFill(0xEEEEEE);
        sceneFourMask.drawCircle(0, 0, 200, 200);
        sceneFourMask.alpha = .95;
        sceneFourMask.x = 125;
        sceneFourMask.y = 250;
        scene4.addChild(sceneFourMask)

        let sceneFourMaskTwo = new PIXI.Graphics();
        sceneFourMaskTwo.beginFill(0xEEEEEE);
        sceneFourMaskTwo.drawCircle(0, 0, 125, 125);
        sceneFourMaskTwo.alpha = .95;
        sceneFourMaskTwo.x = 325;
        sceneFourMaskTwo.y = 25;
        scene4.addChild(sceneFourMaskTwo)

        let fish3Text = new PIXI.Text('This is the Silver Fish \nA fish that looks like a \nminiature tuna at times, \nit likes when the user \nfeeds it food; we ran\nout so now it \njust wags', { fill: 0x000000 });
        fish3Text.x = 35;
        fish3Text.y = 150;
        fish3Text.style.fontFamily = 'Sans-Sarif';

        scene4.addChild(fish3Text);

        //Scene 4 Buttons
        let backButtonThree = UI.Button(0, 380, "< Back");
        scene4.addChild(backButtonThree);

        //Let's call it the Director. It calls the shots.
        var Director = {

            //It holds a list of scenes
            scene: {},

            //Add a scene to the list
            addScene: (name, scene) => {

                //If it exists throw an error
                if (Director.scene[name])
                    throw "That scene already exists!"

                //Otherwise add it
                Director.scene[name] = scene;

                //If it's the first scene, make it the active one
                if (Director.currentScene == null)
                    Director.currentScene = name;

            },

            //And it keeps track of the current one
            currentScene: null,

            //And a function to change scenes
            showScene: async (nextSceneName, params) => {

                if (params == undefined) params = {};

                let currentScene = Director.scene[Director.currentScene];
                let nextScene = Director.scene[nextSceneName];

                if (params.transition == undefined)
                    params.transition = Director.cut;

                await params.transition(currentScene, nextScene, params);

                Director.currentScene = nextSceneName;

            },

            //
            //Transitions
            //

            //Cut (no transition)
            cut: async (currentScene, nextScene, params) => {
                app.stage.removeChild(currentScene);
                app.stage.addChild(nextScene);
            },

            //Fade between
            fade: async (currentScene, nextScene, params) => {

                //Check duration
                if (params == undefined) params = {};
                if (params.duration == undefined) params.duration = 500;

                //Fade out current scene
                await Animate.to(currentScene, { alpha: 0, duration: params.duration / 2 });
                //Remove it from stage
                app.stage.removeChild(currentScene);
                //Set next scene to zero alpha
                nextScene.alpha = 0;
                //Add it to the stage
                app.stage.addChild(nextScene);
                //Fade it in
                await Animate.to(nextScene, { alpha: 1, duration: params.duration / 2 });
                //Reset the off-stage scene's alpha back
                currentScene.alpha = 1;
            },

            //Slide in a particular direction
            swipe: async (currentScene, nextScene, params) => {

                //Set up destinations
                let currentSceneEndX, currentSceneEndY;
                let nextSceneStartX, nextSceneStartY;

                //Check duration
                if (params == undefined) params = {};
                if (params.duration == undefined) params.duration = 500;

                //Set default direction
                if (params.direction == undefined) params.direction = "left";

                //Figure out initial and end positions
                if (params.direction == "left") {
                    currentSceneEndX = -app.view.width;
                    currentSceneEndY = 0;
                    nextSceneStartX = app.view.width;
                    nextSceneStartY = 0;
                }
                else if (params.direction == "right") {
                    currentSceneEndX = app.view.width;
                    currentSceneEndY = 0;
                    nextSceneStartX = -app.view.width;
                    nextSceneStartY = 0;
                }
                else if (params.direction == "up") {
                    currentSceneEndX = 0;
                    currentSceneEndY = -app.view.height;
                    nextSceneStartX = 0;
                    nextSceneStartY = app.view.height;
                }
                else if (params.direction == "down") {
                    currentSceneEndX = 0;
                    currentSceneEndY = app.view.height;
                    nextSceneStartX = 0;
                    nextSceneStartY = -app.view.height;
                }

                //Set up next scene
                nextScene.x = nextSceneStartX;
                nextScene.y = nextSceneStartY;
                app.stage.addChild(nextScene);

                //Slide out current scene as it moves off
                Animate.to(currentScene, {
                    x: currentSceneEndX, y: currentSceneEndY,
                    duration: params.duration,
                    easing: Animate.easeInOut
                });
                //WHILE bringing in the next scene
                await Animate.to(nextScene, {
                    x: 0, y: 0,
                    duration: params.duration,
                    easing: Animate.easeInOut
                });
                //We only "await" on the last Animate, so that they both move at the same time

                //Remove the old scene from stage
                app.stage.removeChild(currentScene);

                //And just to be nice, move the old scene back to neutral
                currentScene.x = 0;
                currentScene.y = 0;

            },

        };

        /*
    
            Now let's set up our prior scenes with the Director instead.
    
        */

        Director.addScene("first", scene1);
        Director.addScene("second", scene2);
        Director.addScene("third", scene3);
        Director.addScene("fourth", scene4);

        nextButton.onclick = () => {
            Director.showScene("second", { transition: Director.fade });
        }

        //Buttons for second slide
        backButton.onclick = () => {
            Director.showScene("first", { transition: Director.fade });
        }

        nextButtonTwo.onclick = () => {
            Director.showScene("third", { transition: Director.fade });
        }

        //Buttons for third slide
        backButtonTwo.onclick = () => {
            Director.showScene("second", { transition: Director.fade })
        }

        nextButtonThree.onclick = () => {
            Director.showScene("fourth", { transition: Director.fade });
        }

        //Buttons for fourth slide
        backButtonThree.onclick = () => {
            Director.showScene("third", { transition: Director.fade });
        }

        /*
            This week's homework!
    
            Accept the assignment invite for Meet The Fish (when it goes up).
    
            Put together a multi-scened presentation to show off fictional profiles of 3 of *your* fish. (Replace the ones in the images folder here.)
    
            (Read up on the Graphics and Text display objects here:)
            
                https://pixijs.download/dev/docs/PIXI.Graphics.html
                https://pixijs.download/dev/docs/PIXI.Text.html
            
            (They will help.)
            
            Each fish should be Animated on their profile page in their own unique way.
            
            There should be – at least – a title screen, and one screen for each fish but bonus points for adding on more.
    
            Add to the button system so that the buttons look more aesthetic.
    
            Add in a new transition of your choice and implement it on one of your transitions.
    
        */

        //Animate logic
        // Animate loop function
        function AnimateLoop() {
            let time = Date.now();

            let bubbly1 = Math.sin(time / 500) * 5;
            let bubbly2 = Math.cos(time / 500) * 5;
            //let sway = Math.sin(time / 1500) * 10;

            // Bubble Animates
            bubble1.y = bubbly1;
            bubble2.y = bubbly2;
            bubble3.y = bubbly2;
            bubble4.y = bubbly1;

            bubble5.y = bubbly2;
            bubble6.y = bubbly1;
            bubble7.y = bubbly1;
            bubble8.y = bubbly2;

            //setTimeout(AnimateLoop, 1000 / 30);
            requestAnimationFrame(AnimateLoop);
        }
        AnimateLoop();

        // pause animation function
        function pause(ms) {
            return new Promise((resolve, reject) => {
                setTimeout(resolve, ms);
            });
        }

        // stop animation function
        Animate.stop = function (obj) {
            cancelAnimationFrame(obj).animationID;
        }



        // animate background school of fish, get larger as pass right
        async function backgroundFish() {
            await Animate.to(school, {
                x: -1000, y: 55,
                duration: 3000,
            });
            await school.scale.set(-.25);
            await school.alpha == .95;
            await Animate.to(school, {
                x: 2000, y: 200,
                duration: 2100,
            });
            await school.scale.set(.10);
            backgroundFish();
        }
        backgroundFish();

        // animate kelp
        async function sway() {
            await Animate.to(kelp1, {
                x: 50, y: 0,
                duration: 5000,
                easing: Animate.easeInOut
            });
            await Animate.to(kelp1, {
                x: 20, y: 0,
                duration: 5000,
                easing: Animate.easeInOut
            });
            sway();
        }
        sway();
        async function sway2() {
            await Animate.to(kelp2, {
                x: 50, y: 0,
                duration: 4000,
                easing: Animate.easeInOut
            });
            await Animate.to(kelp2, {
                x: 30, y: 0,
                duration: 4000,
                easing: Animate.easeInOut
            });
            sway2();
        }
        sway2();

        // animate fish2, cycle random tint colors
        async function idleSwim2() {
            await Animate.to(fish2, {
                x: 30, y: 20,
                duration: 2000,
                easing: Animate.easeInOut
            });
            fish2.tint = (Math.floor(Math.random() * 0xFFFFFF));
            await Animate.to(fish2, {
                x: 30, y: 60,
                duration: 2000,
                easing: Animate.easeInOut
            });
            idleSwim2();
        }
        idleSwim2();

        // animate fish3
        async function idleSwim3() {
            await Animate.to(fish3, {
                x: 350, y: 0,
                duration: 3000,
                easing: Animate.easeInOut
            });
            await Animate.to(fish3, {
                x: 350, y: 20,
                duration: 3000,
                easing: Animate.easeInOut
            });
            idleSwim3();
        }
        idleSwim3();

        // make fish3 interactive
        fish3.interactive = true;

        // on pointerdown make fish3 blow bubble, rise to surface and pop
        fish3.on('pointerdown', fishBubble);

        // create betta fish bubble
        let bettaBubble = new PIXI.Graphics();
        bettaBubble.beginFill(0xFFFFFF);
        bettaBubble.drawCircle(350, 30, 3, 25);
        bettaBubble.alpha = .7;
        app.stage.addChild(bettaBubble);
        bettaBubble.visible = false;

        // animate betta fish bubble
        async function fishBubble() {
            bettaBubble.visible = true;
            await Animate.to(bettaBubble, {
                x: 0, y: -30, duration: 2000
            });
            await pause(1000)
            bettaBubble.visible = false;
            await Animate.to(bettaBubble, {
                x: 0, y: 25, duration: 0
            });
        }

        // create fish food graphic
        let fishFood = new PIXI.Graphics();
        fishFood.beginFill(0x964B00);
        fishFood.drawCircle(450, 10, 2, 50); //450,25,2,50 with y -150
        app.stage.addChild(fishFood);
        fishFood.visible = false;

        // make fish1 interactive
        fish1.interactive = true;

        // on pointerdown call feeding function with nested feed function
        fish1.on('pointerdown', feeding);

        // fish1 interaction function, rotation change
        async function feeding() {
            fishFood.visible = true;
            fishFood.alpha = 1;
            fish1.pivot.x = 500;
            fish1.pivot.y = 1200;
            fish1.rotation = 1.5;
            async function feed() {
                await Animate.to(fish1, {
                    x: 420, y: -70,
                    duration: 2000,
                    easing: Animate.easeInOut
                });
                await pause(1000);
                feed();
                idleSwim1();
                fishFood.alpha = 0;
                fish1.rotation = 0;
            };
            feed();
            //idleSwim1();
        }

    </script>

</body>

</html>